---
title: "Darts Difficulty data Analysis"
author: "Mika Asaba (masaba@stanford.edu), Julien Boussard (julienb@stanford.edu)"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    highlight: pygments
    theme: flatly
    toc: yes
    toc_float: true
  pdf_document:
    toc: yes
  word_document:
    toc: yes
---

Experiment 1 -- Pilot
---------------------------------------------
**Date run: 11/20/2018**

**Experiment structure:**

(1) First, participants rated the likelihood of success for each board used in the experiment (1/6, 3/6, 5/6; referred to as baseline trials).

(2) Second, participants learned about the task and answered some check questions (referred to as demo trials).

(3) Third, for the bulk of the study, participants underwent 36 unique trials with agents who attempted different dart boards and then rated the likelihood of each agent's success on a dart board (referred to as test trials).

(4) Finally, participants filled out a demographics survey.

**Trial information:**

The 36 trials varied with respect to:

- Difficulty of observed dart board (1/6, 3/6, 5/6; 1/6 is the most difficult board)
- Observed outcome (fail or success; outcome kept constant for each agent)
- Amount of observations (1 attempt, 3 attempts)
- Difficulty of new board (1/6, 3/6, 5/6)
- Trial order and agent randomized
- Half of the agents were male, half were female

**Data structure:**

- order_baseline: order of baseline trials
- order_demo: order of demo trials
- order_trials: order of test trials
- responses_baseline: responses for baseline trials
- responses_demo: respones for check questions in beginning
- responses_rating: responses for ratings on test trials
- responses_observation: responses for check questions on observation pages

### Load Libraries
```{r message=FALSE}
library(ggplot2)
library(lme4)
library(tidyverse)
library(readxl)
library(langcog) # https://github.com/langcog/langcog-package
library(psych)
library(viridis) #creating colorblind-friendly fills
library(gridExtra)
library(lmerTest)
library(compute.es)
library(metafor)
```

### Load Data

Demographics data frame.
```{r warning=FALSE}
setwd("../exp1/mturk/production-results/")

files = list.files(pattern = '*.json')

demog.data.raw <- data.frame() 

for (f in 1:length(files)) {
  #read in file
  jd <- fromJSON(file = files[f])
  
  demog.data.subj <- data.frame(
                          id = jd$AssignmentId, #don't use worker ID!
                          age = jd$answers$data$demographics[[1]][[1]]$value,
                          lang = jd$answers$data$demographics[[1]][[2]]$value,
                          race = jd$answers$data$demographics[[1]][[3]]$value,
                          gender = jd$answers$data$demographics[[1]][[4]]$value,
                          colorblind =jd$answers$data$demographics[[1]][[5]]$value,
                          focus = jd$answers$data$demographics[[1]][[6]]$value,
                          issues = jd$answers$data$demographics[[1]][[7]]$value)
  
  
  demog.data.raw <- bind_rows(demog.data.raw, demog.data.subj)
}
```

Baseline ratings data frame.
```{r warning=FALSE}
setwd("../exp1/mturk/production-results/")

files = list.files(pattern = '*.json')

baseline.data.raw <- data.frame() 

for (f in 1:length(files)) {
  #read in file
  jd <- fromJSON(file = files[f])
  
  baseline.data.subj <- data.frame(
                          id = jd$AssignmentId, #don't use worker ID!
                          trial = jd$answers$data$order_baseline,
                          responses = jd$answers$data$responses_baseline)
  
  
  baseline.data.raw <- bind_rows(baseline.data.raw, baseline.data.subj)
}
```

Intro check questions data frame.
```{r, message=FALSE, warning=FALSE}
#get data from ver1 participants
setwd("../exp1/mturk/production-results/")

files = list.files(pattern = '*.json')

check.data.raw <- data.frame() 

for (f in 1:length(files)) {
  #read in file
  jd <- fromJSON(file = files[f])
  
  check.data.subj <- data.frame(
                          id = jd$AssignmentId, #don't use worker ID!
                          order_demo = jd$answers$data$order_demo,
                          responses_demo = jd$answers$data$responses_demo)
  
  check.data.raw <- bind_rows(check.data.raw, check.data.subj)
}
```

Observation check questions data frame.
```{r, message=FALSE, warning=FALSE}
#get data from ver1 participants
setwd("../exp1/mturk/production-results/")

files = list.files(pattern = '*.json')

obs.data.raw <- data.frame() 

for (f in 1:length(files)) {
  #read in file
  jd <- fromJSON(file = files[f])
  
  obs.data.subj <- data.frame(
                          id = jd$AssignmentId, #don't use worker ID!
                       #   order_observation = jd$answers$data$order_observation,
                          responses_observation = jd$answers$data$responses_observation,
                          responses_observation_correct = jd$answers$data$correct_observation_responses)
  
  obs.data.raw <- bind_rows(obs.data.raw, obs.data.subj)
}
```

Ratings data frame.
```{r, message=FALSE, warning=FALSE}
#get data from ver1 participants
setwd("../exp1/mturk/production-results/")

files = list.files(pattern = '*.json')

rate.data.raw <- data.frame() 

for (f in 1:length(files)) {
  #read in file
  jd <- fromJSON(file = files[f])
  
  rate.data.subj <- data.frame(
                          id = jd$AssignmentId, #don't use worker ID!
                          trial = jd$answers$data$order_trials,
                          rating = jd$answers$data$responses_rating)

  rate.data.raw <- bind_rows(rate.data.raw, rate.data.subj)
}
```

### Tidy Data

Tidy baseline data.
```{r}
# come back to this
#base.tidy = baseline.data.raw %>%
  
```

Tidy ratings data.
```{r}
rate.tidy = rate.data.raw %>%
  mutate(trial = str_sub(trial, 6, str_length(trial)), # remove names
         obs_diff = str_sub(trial, 1, 1),
         rate_diff = str_sub(trial, 3, 3),
         amount = str_sub(trial, 5, 5),
         outcome = str_sub(trial, 7, str_length(trial)))
```

### Plots

Baseline plot.
```{r}
ggplot(baseline.data.raw, aes(x = as.numeric(responses))) +
  geom_histogram() +
  facet_grid(~ trial) +
  theme_minimal()
```

Ratings plot.
```{r}
ggplot(rate.tidy, aes(x = as.numeric(rating, fill=outcome))) +
  geom_histogram() +
  facet_grid(obs_diff ~ rate_diff ~ amount) +
  theme_minimal()
```